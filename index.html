<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dosya Yükleme ve Görüntüleme</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>
    <h1>Dosya Yükleme ve Görüntüleme</h1>

    <!-- Dosya yükleme widget'ı -->
    <button id="upload_widget_opener">Dosya Yükle</button>

    <!-- Yükleme sonrası bilgilendirme -->
    <section id="file-info"></section>

    <!-- Yüklenen dosyaların listeleneceği alan -->
    <section id="dosyalari-goruntule">
        <h2>Yüklenen Dosyaları Görüntüle</h2>
        <ul id="file-list"></ul>
    </section>

    <script>
        // Dosya yükleme işlevi
        function handleFileUpload(file) {
            const formData = new FormData();
            formData.append("file", file);
            formData.append("upload_preset", "upload");  // Cloudinary upload preset adınız
            formData.append("cloud_name", "dwnyfntvd");

            axios.post("https://api.cloudinary.com/v1_1/dwnyfntvd/upload", formData)
                .then((response) => {
                    const fileUrl = response.data.secure_url;
                    document.getElementById("file-info").innerHTML = `
                        Dosya başarıyla yüklendi! 
                        Dosya URL'si: <a href="${fileUrl}" target="_blank">${fileUrl}</a>
                    `;

                    // Yüklenen dosya URL'sini localStorage'a kaydet
                    saveFileToLocalStorage(fileUrl);
                })
                .catch((error) => {
                    console.error("Dosya yüklenirken hata oluştu:", error);
                });
        }

        // Yüklenen dosyaları localStorage'a kaydet
        function saveFileToLocalStorage(fileUrl) {
            let uploadedFiles = JSON.parse(localStorage.getItem("uploadedFiles")) || [];
            uploadedFiles.push(fileUrl);
            localStorage.setItem("uploadedFiles", JSON.stringify(uploadedFiles));
            displayUploadedFiles(); // Dosyaları tekrar göster
        }

        // Sayfa yüklendiğinde localStorage'tan dosyaları göster
        function displayUploadedFiles() {
            let uploadedFiles = JSON.parse(localStorage.getItem("uploadedFiles")) || [];
            const fileListElement = document.getElementById("file-list");
            fileListElement.innerHTML = ""; // Önceki listeyi temizle

            uploadedFiles.forEach(fileUrl => {
                const listItem = document.createElement("li");
                listItem.innerHTML = `<a href="${fileUrl}" target="_blank">Yüklenen Dosya: ${fileUrl}</a>`;
                fileListElement.appendChild(listItem);
            });
        }

        // Sayfa yüklendiğinde yüklenen dosyaları göster
        window.onload = function() {
            displayUploadedFiles(); // Sayfa açıldığında dosyaları görüntüle
        };

        // Dosya yükleme butonuna tıklanırsa
        document.getElementById("upload_widget_opener").addEventListener("click", function () {
            if (typeof cloudinary !== 'undefined') {
                myWidget.open();
            } else {
                console.log("Cloudinary widget is not loaded correctly.");
            }
        });

        // Cloudinary widget başlatma ve dosya yükleme
        var myWidget = cloudinary.createUploadWidget({
            cloudName: 'dwnyfntvd', 
            uploadPreset: 'upload', 
            sources: ['local', 'url', 'camera', 'image_search'],
            showAdvancedOptions: true,
            cropping: true,
            multiple: false
        }, (error, result) => {
            if (result && result.event === "success") {
                handleFileUpload(result.info.files[0].file);
            }
        });
    </script>
</body>
</html>
